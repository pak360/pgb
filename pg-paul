app:
  slug: "profitbot"
  name: "ProfitBot"
  version: "1.0"
  type: "chatbot"
  mode: "chat"
  description: "A chatbot that tracks revenue, expenses, profitability, break-even analysis, scenario planning, and alerts."
kind: app
version: 0.1.5

model_config:
  provider: "openai"
  model: "gpt-4"
  parameters:
    temperature: 0.7
    max_tokens: 3000

conversation:
  initialPrompt: "How's it going? I'm Profit Paul Bot here to help you with revenue tracking, expenses, profitability, and more. How can I assist you today?"

steps:
  - id: "step1_initialization"
    title: "Step 1: Initialization"
    description: "Collect base financial and operational data."
    type: "collectData"
    prompts:
      - id: "init_data_collection"
        message: >-
          To begin, please provide the following data. 
          If you don't have any value, you can skip or enter 0:
          1. Fixed costs (e.g., R&D, tooling)
          2. Variable costs per unit
          3. Sales price per unit
          4. Units sold
          5. Marketing budget
          6. Recurring expenses (e.g., hosting, subscriptions)
    fields:
      - key: "fixed_costs"
        label: "Fixed Costs"
        type: "number"
        required: true
        default: 0
      - key: "variable_costs"
        label: "Variable Costs (per unit)"
        type: "number"
        required: true
        default: 0
      - key: "sales_price"
        label: "Sales Price (per unit)"
        type: "number"
        required: true
        default: 0
      - key: "units_sold"
        label: "Units Sold"
        type: "number"
        required: true
        default: 0
      - key: "marketing_budget"
        label: "Marketing Budget"
        type: "number"
        required: true
        default: 0
      - key: "recurring_expenses"
        label: "Recurring Expenses"
        type: "number"
        required: false
        default: 0
    nextStep: "step2_data_processing"

  - id: "step2_data_processing"
    title: "Step 2: Data Processing"
    description: "Compute revenue, total costs, profit, and break-even progress."
    type: "logicProcessing"
    calculations:
      - name: "Revenue"
        formula: "revenue = units_sold * sales_price"
      - name: "TotalCosts"
        formula: "total_costs = fixed_costs + (variable_costs * units_sold) + marketing_budget + recurring_expenses"
      - name: "Profit"
        formula: "profit = revenue - total_costs"
      - name: "BreakEvenUnits"
        formula: "break_even_units = fixed_costs / (sales_price - variable_costs)"
    outputs:
      - "revenue"
      - "total_costs"
      - "profit"
      - "break_even_units"
    prompts:
      - id: "processing_results"
        message: >-
          Here are your current calculations:
          - Revenue: {{revenue}}
          - Total Costs: {{total_costs}}
          - Profit: {{profit}}
          - Break-even Units: {{break_even_units}}

          Do you want to proceed to scenario planning?
    nextStep: "step3_scenario_planning"

  - id: "step3_scenario_planning"
    title: "Step 3: Scenario Planning"
    description: "Allow users to modify assumptions and recalculate break-even, profit, etc."
    type: "collectData"
    prompts:
      - id: "scenario_prompt"
        message: >-
          What changes would you like to simulate? For example:
          - Adjust sales price
          - Change units sold (growth projections)
          - Modify marketing budget

          Enter only the fields you want to change. (Type 'none' or 'skip' to keep everything the same.)
    fields:
      - key: "scenario_sales_price"
        label: "New Sales Price (optional)"
        type: "number"
        required: false
      - key: "scenario_units_sold"
        label: "New Units Sold Projection (optional)"
        type: "number"
        required: false
      - key: "scenario_marketing_budget"
        label: "New Marketing Budget (optional)"
        type: "number"
        required: false
    logic:
      type: "dynamicRecalculation"
      calculations:
        - name: "scenario_revenue"
          formula: "scenario_revenue = (scenario_units_sold || units_sold) * (scenario_sales_price || sales_price)"
        - name: "scenario_total_costs"
          formula: "scenario_total_costs = fixed_costs + (variable_costs * (scenario_units_sold || units_sold)) + (scenario_marketing_budget || marketing_budget) + recurring_expenses"
        - name: "scenario_profit"
          formula: "scenario_profit = scenario_revenue - scenario_total_costs"
        - name: "scenario_break_even_units"
          formula: "scenario_break_even_units = fixed_costs / ((scenario_sales_price || sales_price) - variable_costs)"
      outputs:
        - "scenario_revenue"
        - "scenario_total_costs"
        - "scenario_profit"
        - "scenario_break_even_units"
      promptsAfter:
        - id: "scenario_results"
          message: >-
            Scenario results:
            - Revenue: {{scenario_revenue}}
            - Total Costs: {{scenario_total_costs}}
            - Profit: {{scenario_profit}}
            - Break-even Units: {{scenario_break_even_units}}

            Original vs. Updated:
            - Original Revenue: {{revenue}} -> New: {{scenario_revenue}}
            - Original Profit: {{profit}} -> New: {{scenario_profit}}
            - Original Break-even Units: {{break_even_units}} -> New: {{scenario_break_even_units}}
      nextStep: "step4_visualization"

  - id: "step4_visualization"
    title: "Step 4: Visualization"
    description: "Generate charts for revenue vs. expenses, break-even progress, profit margin trends, and scenario comparisons."
    type: "visualization"
    charts:
      - id: "chart_revenue_vs_expenses"
        title: "Revenue vs. Expenses"
        type: "lineChart"
        xAxis: "time"
        series:
          - "revenue"
          - "total_costs"
      - id: "chart_break_even_progress"
        title: "Break-even Progress"
        type: "barChart"
        xAxis: "units"
        series:
          - "units_sold"
          - "break_even_units"
      - id: "chart_profit_margin_trends"
        title: "Profit Margins Over Time"
        type: "lineChart"
        xAxis: "time"
        series:
          - "profitMargin"
      - id: "chart_scenario_comparison"
        title: "What-if Scenario Comparison"
        type: "comparisonChart"
        comparisons:
          - label: "Original"
            revenue: "revenue"
            costs: "total_costs"
            profit: "profit"
          - label: "Scenario"
            revenue: "scenario_revenue"
            costs: "scenario_total_costs"
            profit: "scenario_profit"
    prompts:
      - id: "visualization_prompt"
        message: "Here are your requested charts and comparisons. Let me know if you'd like to make any adjustments."
    nextStep: null
